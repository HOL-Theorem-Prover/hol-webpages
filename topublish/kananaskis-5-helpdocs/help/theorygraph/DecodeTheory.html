<HTML>
<head><link rel="icon" href="../../../images/logo.ico" type="image/vnd.microsoft.icon"><TITLE>Theory: Decode</TITLE><meta http-equiv="content-type" content="text/html;charset=UTF-8">
</HEAD>
<BODY bgcolor=linen text=midnightblue>
<H1><font color="black">Theory "Decode"</font></H1>
<STRONG><font size=+3 color="black">Parents</font></STRONG>&nbsp;&nbsp;&nbsp;&nbsp;
    <A HREF = "EncodeTheory.html"><STRONG><font color="black">Encode</font></STRONG></A>

<H1><font color="black">Signature</font></H1>
<center>
<table BORDER=4 CELLPADDING=10 CELLSPACING=1>

    <tr>
    <th>
    <font color="crimson">Constant</font>
    <th>
    <font color="crimson">Type</font><tr><td>
                                         <STRONG><font color="black">dec2enc</font></STRONG>
                                         <td>
                                         :(bool list ->
                                           ('a # bool list) option) ->
                                          'a -> bool list
    <tr><td>
        <STRONG><font color="black">dec_bnum</font></STRONG>
        <td>
        :num -> bool list -> (num # bool list) option
    <tr><td>
        <STRONG><font color="black">decode_blist</font></STRONG>
        <td>
        :('a list -> bool) ->
         num ->
         (bool list -> ('a # bool list) option) ->
         bool list -> ('a list # bool list) option
    <tr><td>
        <STRONG><font color="black">decode_bnum</font></STRONG>
        <td>
        :num -> (num -> bool) -> bool list -> (num # bool list) option
    <tr><td>
        <STRONG><font color="black">decode_bool</font></STRONG>
        <td>
        :(bool -> bool) -> bool list -> (bool # bool list) option
    <tr><td>
        <STRONG><font color="black">decode_list</font></STRONG>
        <td>
        :('a list -> bool) ->
         (bool list -> ('a # bool list) option) ->
         bool list -> ('a list # bool list) option
    <tr><td>
        <STRONG><font color="black">decode_num</font></STRONG>
        <td>
        :(num -> bool) -> bool list -> (num # bool list) option
    <tr><td>
        <STRONG><font color="black">decode_option</font></STRONG>
        <td>
        :('a option -> bool) ->
         (bool list -> ('a # bool list) option) ->
         bool list -> ('a option # bool list) option
    <tr><td>
        <STRONG><font color="black">decode_prod</font></STRONG>
        <td>
        :('a # 'b -> bool) ->
         (bool list -> ('a # bool list) option) ->
         (bool list -> ('b # bool list) option) ->
         bool list -> (('a # 'b) # bool list) option
    <tr><td>
        <STRONG><font color="black">decode_sum</font></STRONG>
        <td>
        :('a + 'b -> bool) ->
         (bool list -> ('a # bool list) option) ->
         (bool list -> ('b # bool list) option) ->
         bool list -> (('a + 'b) # bool list) option
    <tr><td>
        <STRONG><font color="black">decode_tree</font></STRONG>
        <td>
        :('a tree -> bool) ->
         (bool list -> ('a # bool list) option) ->
         bool list -> ('a tree # bool list) option
    <tr><td>
        <STRONG><font color="black">decode_unit</font></STRONG>
        <td>
        :(unit -> bool) -> bool list -> (unit # bool list) option
    <tr><td>
        <STRONG><font color="black">enc2dec</font></STRONG>
        <td>
        :('a -> bool) ->
         ('a -> bool list) -> bool list -> ('a # bool list) option
    <tr><td>
        <STRONG><font color="black">wf_decoder</font></STRONG>
        <td>
        :('a -> bool) -> (bool list -> ('a # bool list) option) -> bool
    
</table>
</center>

<H1><font color="black">Definitions</font></H1>
<DL>
<DT><STRONG><font color="black">wf_decoder_def</font></STRONG>
<DD>
<PRE>
|- !p d.
     wf_decoder p d <=>
     !x.
       if p x then
         ?a. !b c. (d b = SOME (x,c)) <=> (b = a ++ c)
       else
         !a b. d a <> SOME (x,b)
</PRE>

<DT><STRONG><font color="black">enc2dec_def</font></STRONG>
<DD>
<PRE>
|- !p e l.
     enc2dec p e l =
     if ?x t. p x /\ (l = e x ++ t) then
       SOME (@(x,t). p x /\ (l = e x ++ t))
     else
       NONE
</PRE>

<DT><STRONG><font color="black">dec2enc_def</font></STRONG>
<DD>
<PRE>
|- !d x. dec2enc d x = @l. d l = SOME (x,[])
</PRE>

<DT><STRONG><font color="black">decode_unit_def</font></STRONG>
<DD>
<PRE>
|- !p. decode_unit p = enc2dec p encode_unit
</PRE>

<DT><STRONG><font color="black">decode_bool_def</font></STRONG>
<DD>
<PRE>
|- !p. decode_bool p = enc2dec p encode_bool
</PRE>

<DT><STRONG><font color="black">decode_prod_def</font></STRONG>
<DD>
<PRE>
|- !p d1 d2.
     decode_prod p d1 d2 = enc2dec p (encode_prod (dec2enc d1) (dec2enc d2))
</PRE>

<DT><STRONG><font color="black">decode_sum_def</font></STRONG>
<DD>
<PRE>
|- !p d1 d2.
     decode_sum p d1 d2 = enc2dec p (encode_sum (dec2enc d1) (dec2enc d2))
</PRE>

<DT><STRONG><font color="black">decode_option_def</font></STRONG>
<DD>
<PRE>
|- !p d. decode_option p d = enc2dec p (encode_option (dec2enc d))
</PRE>

<DT><STRONG><font color="black">decode_list_def</font></STRONG>
<DD>
<PRE>
|- !p d. decode_list p d = enc2dec p (encode_list (dec2enc d))
</PRE>

<DT><STRONG><font color="black">decode_blist_def</font></STRONG>
<DD>
<PRE>
|- !p m d. decode_blist p m d = enc2dec p (encode_blist m (dec2enc d))
</PRE>

<DT><STRONG><font color="black">decode_num_def</font></STRONG>
<DD>
<PRE>
|- !p. decode_num p = enc2dec p encode_num
</PRE>

<DT><STRONG><font color="black">decode_bnum_def</font></STRONG>
<DD>
<PRE>
|- !m p. decode_bnum m p = enc2dec p (encode_bnum m)
</PRE>

<DT><STRONG><font color="black">dec_bnum_def</font></STRONG>
<DD>
<PRE>
|- (!l. dec_bnum 0 l = SOME (0,l)) /\
   !m l.
     dec_bnum (SUC m) l =
     case l of
        [] -> NONE
     || h::t ->
          case dec_bnum m t of
             NONE -> NONE
          || SOME (n,t') -> SOME (2 * n + if h then 1 else 0,t')
</PRE>

<DT><STRONG><font color="black">decode_tree_def</font></STRONG>
<DD>
<PRE>
|- !p d. decode_tree p d = enc2dec p (encode_tree (dec2enc d))
</PRE>

</DL>


<HR>

<HR>
<H1><font color="black">Theorems</font></H1>
<DL>
<DT><STRONG><font color="black">enc2dec_none</font></STRONG>
<DD>
<PRE>
|- !p e l. (enc2dec p e l = NONE) <=> !x t. p x ==> l <> e x ++ t
</PRE>

<DT><STRONG><font color="black">enc2dec_some</font></STRONG>
<DD>
<PRE>
|- !p e l x t.
     wf_encoder p e ==>
     ((enc2dec p e l = SOME (x,t)) <=> p x /\ (l = e x ++ t))
</PRE>

<DT><STRONG><font color="black">enc2dec_some_alt</font></STRONG>
<DD>
<PRE>
|- !p e l x.
     wf_encoder p e ==>
     ((enc2dec p e l = SOME x) <=> p (FST x) /\ (l = e (FST x) ++ SND x))
</PRE>

<DT><STRONG><font color="black">wf_enc2dec</font></STRONG>
<DD>
<PRE>
|- !p e. wf_encoder p e ==> wf_decoder p (enc2dec p e)
</PRE>

<DT><STRONG><font color="black">dec2enc_some</font></STRONG>
<DD>
<PRE>
|- !p d x l.
     wf_decoder p d ==> ((dec2enc d x = l) /\ p x <=> (d l = SOME (x,[])))
</PRE>

<DT><STRONG><font color="black">decode_dec2enc</font></STRONG>
<DD>
<PRE>
|- !p d x. wf_decoder p d /\ p x ==> (d (dec2enc d x) = SOME (x,[]))
</PRE>

<DT><STRONG><font color="black">decode_dec2enc_append</font></STRONG>
<DD>
<PRE>
|- !p d x t. wf_decoder p d /\ p x ==> (d (dec2enc d x ++ t) = SOME (x,t))
</PRE>

<DT><STRONG><font color="black">wf_dec2enc</font></STRONG>
<DD>
<PRE>
|- !p d. wf_decoder p d ==> wf_encoder p (dec2enc d)
</PRE>

<DT><STRONG><font color="black">dec2enc_enc2dec</font></STRONG>
<DD>
<PRE>
|- !p e x. wf_encoder p e /\ p x ==> (dec2enc (enc2dec p e) x = e x)
</PRE>

<DT><STRONG><font color="black">enc2dec_dec2enc</font></STRONG>
<DD>
<PRE>
|- !p d. wf_decoder p d ==> (enc2dec p (dec2enc d) = d)
</PRE>

<DT><STRONG><font color="black">wf_decode_unit</font></STRONG>
<DD>
<PRE>
|- wf_decoder p (decode_unit p)
</PRE>

<DT><STRONG><font color="black">dec2enc_decode_unit</font></STRONG>
<DD>
<PRE>
|- !p x. p x ==> (dec2enc (decode_unit p) x = encode_unit x)
</PRE>

<DT><STRONG><font color="black">decode_unit</font></STRONG>
<DD>
<PRE>
|- decode_unit p l = if p () then SOME ((),l) else NONE
</PRE>

<DT><STRONG><font color="black">wf_decode_bool</font></STRONG>
<DD>
<PRE>
|- !p. wf_decoder p (decode_bool p)
</PRE>

<DT><STRONG><font color="black">dec2enc_decode_bool</font></STRONG>
<DD>
<PRE>
|- !p x. p x ==> (dec2enc (decode_bool p) x = encode_bool x)
</PRE>

<DT><STRONG><font color="black">decode_bool</font></STRONG>
<DD>
<PRE>
|- decode_bool p l =
   case l of [] -> NONE || h::t -> if p h then SOME (h,t) else NONE
</PRE>

<DT><STRONG><font color="black">wf_decode_prod</font></STRONG>
<DD>
<PRE>
|- !p1 p2 d1 d2.
     wf_decoder p1 d1 /\ wf_decoder p2 d2 ==>
     wf_decoder (lift_prod p1 p2) (decode_prod (lift_prod p1 p2) d1 d2)
</PRE>

<DT><STRONG><font color="black">dec2enc_decode_prod</font></STRONG>
<DD>
<PRE>
|- !p1 p2 d1 d2 x.
     wf_decoder p1 d1 /\ wf_decoder p2 d2 /\ lift_prod p1 p2 x ==>
     (dec2enc (decode_prod (lift_prod p1 p2) d1 d2) x =
      encode_prod (dec2enc d1) (dec2enc d2) x)
</PRE>

<DT><STRONG><font color="black">encode_then_decode_prod</font></STRONG>
<DD>
<PRE>
|- !p1 p2 e1 e2 l t.
     wf_encoder p1 e1 /\ wf_encoder p2 e2 /\ lift_prod p1 p2 l ==>
     (decode_prod (lift_prod p1 p2) (enc2dec p1 e1) (enc2dec p2 e2)
        (encode_prod e1 e2 l ++ t) =
      SOME (l,t))
</PRE>

<DT><STRONG><font color="black">decode_prod</font></STRONG>
<DD>
<PRE>
|- wf_decoder p1 d1 /\ wf_decoder p2 d2 ==>
   (decode_prod (lift_prod p1 p2) d1 d2 l =
    case d1 l of
       NONE -> NONE
    || SOME (x,t) ->
         case d2 t of NONE -> NONE || SOME (y,t') -> SOME ((x,y),t'))
</PRE>

<DT><STRONG><font color="black">wf_decode_sum</font></STRONG>
<DD>
<PRE>
|- !p1 p2 d1 d2.
     wf_decoder p1 d1 /\ wf_decoder p2 d2 ==>
     wf_decoder (lift_sum p1 p2) (decode_sum (lift_sum p1 p2) d1 d2)
</PRE>

<DT><STRONG><font color="black">dec2enc_decode_sum</font></STRONG>
<DD>
<PRE>
|- !p1 p2 d1 d2 x.
     wf_decoder p1 d1 /\ wf_decoder p2 d2 /\ lift_sum p1 p2 x ==>
     (dec2enc (decode_sum (lift_sum p1 p2) d1 d2) x =
      encode_sum (dec2enc d1) (dec2enc d2) x)
</PRE>

<DT><STRONG><font color="black">encode_then_decode_sum</font></STRONG>
<DD>
<PRE>
|- !p1 p2 e1 e2 l t.
     wf_encoder p1 e1 /\ wf_encoder p2 e2 /\ lift_sum p1 p2 l ==>
     (decode_sum (lift_sum p1 p2) (enc2dec p1 e1) (enc2dec p2 e2)
        (encode_sum e1 e2 l ++ t) =
      SOME (l,t))
</PRE>

<DT><STRONG><font color="black">decode_sum</font></STRONG>
<DD>
<PRE>
|- wf_decoder p1 d1 /\ wf_decoder p2 d2 ==>
   (decode_sum (lift_sum p1 p2) d1 d2 l =
    case l of
       [] -> NONE
    || T::t -> (case d1 t of NONE -> NONE || SOME (x,t') -> SOME (INL x,t'))
    || F::t -> case d2 t of NONE -> NONE || SOME (x,t') -> SOME (INR x,t'))
</PRE>

<DT><STRONG><font color="black">wf_decode_option</font></STRONG>
<DD>
<PRE>
|- !p d.
     wf_decoder p d ==>
     wf_decoder (lift_option p) (decode_option (lift_option p) d)
</PRE>

<DT><STRONG><font color="black">dec2enc_decode_option</font></STRONG>
<DD>
<PRE>
|- !p d x.
     wf_decoder p d /\ lift_option p x ==>
     (dec2enc (decode_option (lift_option p) d) x =
      encode_option (dec2enc d) x)
</PRE>

<DT><STRONG><font color="black">encode_then_decode_option</font></STRONG>
<DD>
<PRE>
|- !p e l t.
     wf_encoder p e /\ lift_option p l ==>
     (decode_option (lift_option p) (enc2dec p e) (encode_option e l ++ t) =
      SOME (l,t))
</PRE>

<DT><STRONG><font color="black">decode_option</font></STRONG>
<DD>
<PRE>
|- wf_decoder p d ==>
   (decode_option (lift_option p) d l =
    case l of
       [] -> NONE
    || T::t -> (case d t of NONE -> NONE || SOME (x,t') -> SOME (SOME x,t'))
    || F::t -> SOME (NONE,t))
</PRE>

<DT><STRONG><font color="black">wf_decode_list</font></STRONG>
<DD>
<PRE>
|- !p d. wf_decoder p d ==> wf_decoder (EVERY p) (decode_list (EVERY p) d)
</PRE>

<DT><STRONG><font color="black">dec2enc_decode_list</font></STRONG>
<DD>
<PRE>
|- !p d x.
     wf_decoder p d /\ EVERY p x ==>
     (dec2enc (decode_list (EVERY p) d) x = encode_list (dec2enc d) x)
</PRE>

<DT><STRONG><font color="black">encode_then_decode_list</font></STRONG>
<DD>
<PRE>
|- !p e l t.
     wf_encoder p e /\ EVERY p l ==>
     (decode_list (EVERY p) (enc2dec p e) (encode_list e l ++ t) = SOME (l,t))
</PRE>

<DT><STRONG><font color="black">decode_list</font></STRONG>
<DD>
<PRE>
|- wf_decoder p d ==>
   (decode_list (EVERY p) d l =
    case l of
       [] -> NONE
    || T::t ->
         (case d t of
             NONE -> NONE
          || SOME (x,t') ->
               case decode_list (EVERY p) d t' of
                  NONE -> NONE
               || SOME (xs,t'') -> SOME (x::xs,t''))
    || F::t -> SOME ([],t))
</PRE>

<DT><STRONG><font color="black">wf_decode_blist</font></STRONG>
<DD>
<PRE>
|- !m p d.
     wf_decoder p d ==>
     wf_decoder (lift_blist m p) (decode_blist (lift_blist m p) m d)
</PRE>

<DT><STRONG><font color="black">dec2enc_decode_blist</font></STRONG>
<DD>
<PRE>
|- !m p d l.
     wf_decoder p d /\ lift_blist m p l ==>
     (dec2enc (decode_blist (lift_blist m p) m d) l =
      encode_blist m (dec2enc d) l)
</PRE>

<DT><STRONG><font color="black">encode_then_decode_blist</font></STRONG>
<DD>
<PRE>
|- !m p e l t.
     wf_encoder p e /\ lift_blist m p l ==>
     (decode_blist (lift_blist m p) m (enc2dec p e)
        (encode_blist m e l ++ t) =
      SOME (l,t))
</PRE>

<DT><STRONG><font color="black">decode_blist</font></STRONG>
<DD>
<PRE>
|- wf_decoder p d ==>
   (decode_blist (lift_blist m p) m d l =
    case m of
       0 -> SOME ([],l)
    || SUC n ->
         case d l of
            NONE -> NONE
         || SOME (x,t) ->
              case decode_blist (lift_blist n p) n d t of
                 NONE -> NONE
              || SOME (xs,t') -> SOME (x::xs,t'))
</PRE>

<DT><STRONG><font color="black">wf_decode_num</font></STRONG>
<DD>
<PRE>
|- !p. wf_decoder p (decode_num p)
</PRE>

<DT><STRONG><font color="black">dec2enc_decode_num</font></STRONG>
<DD>
<PRE>
|- !p x. p x ==> (dec2enc (decode_num p) x = encode_num x)
</PRE>

<DT><STRONG><font color="black">decode_num_total</font></STRONG>
<DD>
<PRE>
|- decode_num (K T) l =
   case l of
      [] -> NONE
   || [T] -> NONE
   || T::T::t -> SOME (0,t)
   || T::F::t ->
        (case decode_num (K T) t of
            NONE -> NONE
         || SOME (v,t') -> SOME (2 * v + 1,t'))
   || F::t' ->
        case decode_num (K T) t' of
           NONE -> NONE
        || SOME (v,t') -> SOME (2 * v + 2,t')
</PRE>

<DT><STRONG><font color="black">decode_num</font></STRONG>
<DD>
<PRE>
|- decode_num p l =
   case l of
      [] -> NONE
   || [T] -> NONE
   || T::T::t -> if p 0 then SOME (0,t) else NONE
   || T::F::t ->
        (case decode_num (K T) t of
            NONE -> NONE
         || SOME (v,t') ->
              if p (2 * v + 1) then SOME (2 * v + 1,t') else NONE)
   || F::t' ->
        case decode_num (K T) t' of
           NONE -> NONE
        || SOME (v,t') -> if p (2 * v + 2) then SOME (2 * v + 2,t') else NONE
</PRE>

<DT><STRONG><font color="black">dec_bnum_lt</font></STRONG>
<DD>
<PRE>
|- !m l n t. (dec_bnum m l = SOME (n,t)) ==> n < 2 ** m
</PRE>

<DT><STRONG><font color="black">dec_bnum_inj</font></STRONG>
<DD>
<PRE>
|- !m l n t. (dec_bnum m l = SOME (n,t)) ==> (l = encode_bnum m n ++ t)
</PRE>

<DT><STRONG><font color="black">wf_decode_bnum</font></STRONG>
<DD>
<PRE>
|- !m p. wf_pred_bnum m p ==> wf_decoder p (decode_bnum m p)
</PRE>

<DT><STRONG><font color="black">dec2enc_decode_bnum</font></STRONG>
<DD>
<PRE>
|- !m p x.
     wf_pred_bnum m p /\ p x ==>
     (dec2enc (decode_bnum m p) x = encode_bnum m x)
</PRE>

<DT><STRONG><font color="black">decode_bnum</font></STRONG>
<DD>
<PRE>
|- wf_pred_bnum m p ==>
   (decode_bnum m p l =
    case dec_bnum m l of
       NONE -> NONE
    || SOME (n,t) -> if p n then SOME (n,t) else NONE)
</PRE>

<DT><STRONG><font color="black">wf_decode_tree</font></STRONG>
<DD>
<PRE>
|- !p d.
     wf_decoder p d ==> wf_decoder (lift_tree p) (decode_tree (lift_tree p) d)
</PRE>

<DT><STRONG><font color="black">decode_tree</font></STRONG>
<DD>
<PRE>
|- wf_decoder p d ==>
   (decode_tree (lift_tree p) d l =
    case d l of
       NONE -> NONE
    || SOME (a,t) ->
         case
           decode_list (EVERY (lift_tree p)) (decode_tree (lift_tree p) d) t
           of
            NONE -> NONE
         || SOME (ts,t') -> SOME (Node a ts,t'))
</PRE>

</DL>



<HR>
</BODY>
</HTML>
